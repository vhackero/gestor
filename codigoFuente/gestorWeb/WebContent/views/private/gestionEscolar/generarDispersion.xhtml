<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html>
<ui:composition template="/templates/layout.xhtml"
	xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:sec="http://www.springframework.org/security/tags">


	<ui:define name="breadcrumb">
		<li>#{sistema.obtenerTexto('gw.gestionescolar.label.gestionEscolar')}</li>
		<li class="active">Dispersiones</li>
	</ui:define>

	<ui:define name="content">

		<h1>Dispersiones</h1>
		<hr />

		<h:form id="frmBusqueda">
			<p:ajaxStatus onstart="PF('dialogLayout').show()"
				onsuccess="PF('dialogLayout').hide()" />

			<p:panel id="fldBusqueda" header="Configuración de dispersión"
				showCollapseLink="false" collapsible="false">
				<f:validateBean disabled="true">

					<!-- Row 1 -->
					<div class="form-group">
						<div class="row">
							<!-- Convocatioria -->
							<div class="col-md-3">
								<p:outputLabel styleClass="requerido" value="Convocatoria:" />
								<p:selectOneMenu
									value="#{eventoCapacitacionBean.filtros.catModalidadPlanPrograma}"
									converter="catalogoComunConverter" required="false"
									styleClass="col-xs-12">
									<f:selectItem
										itemLabel="#{sistema.obtenerTexto('gw.textos.menu.seleccionar')}" />
									<f:selectItems
										value="#{eventoCapacitacionBean.listaModalidadesPrograma}"
										var="modalidad" itemLabel="#{modalidad.nombre}"
										itemValue="#{modalidad}" />
								</p:selectOneMenu>
							</div>

							<!-- Proceso de inscripcion  -->
							<div class="col-md-3">
								<p:outputLabel styleClass="requerido"
									value="Proceso de inscripción:" />
								<p:selectOneMenu id="listInscripcion" required="false"
									value="#{eventoCapacitacionBean.tipoDatoFechas}"
									autoWidth="false" styleClass="col-xs-12">
									<p:ajax update="@form" process="@this"
										listener="#{eventoCapacitacionBean.validarComboFechas}" />
									<f:selectItem
										itemLabel="#{sistema.obtenerTexto('gw.textos.menu.seleccionar')}"
										itemValue="#{null}" />
									<f:selectItems
										value="#{eventoCapacitacionBean.listaModalidadesPrograma}"
										var="modalidad" itemLabel="#{modalidad.nombre}"
										itemValue="#{modalidad}" />
								</p:selectOneMenu>
							</div>
						</div>
					</div>
					<!-- Row 2 -->
					<div class="form-group">
						<div class="row">
							<div class="col-md-4 col-xs-12">
								<p:outputLabel styleClass="requerido" value="Plan:" />
								<p:selectOneMenu id="nvoCatPlan" styleClass="col-xs-12"
									value="#{eventoCapacitacionBean.idPlan}"
									valueChangeListener="#{eventoCapacitacionBean.onChangeCatPlan}">
									<p:ajax update="@form" />
									<f:selectItem
										itemLabel="#{sistema.obtenerTexto('gw.textos.menu.seleccionar')}"
										itemValue="#{0}" />
									<f:selectItems value="#{eventoCapacitacionBean.nodos}"
										var="plan" itemLabel="#{plan.nombre}"
										itemValue="#{plan.idNodo}" />
								</p:selectOneMenu>
								<p:message for="nvoCatPlan" />
							</div>


							<div class="col-md-4 col-xs-12">
								<p:outputLabel styleClass="requerido" value="Bloque:" />
								<p:selectOneMenu id="listBloque" styleClass="col-xs-12"
									valueChangeListener="#{eventoCapacitacionBean.onChangeCatEstructura}">
									<p:ajax update="@form" />
									<f:selectItem
										itemLabel="#{sistema.obtenerTexto('gw.textos.menu.seleccionar')}"
										itemValue="#{0}" />
									<f:selectItems value="#{eventoCapacitacionBean.catEstructuras}"
										var="estruc" itemLabel="#{estruc.nombre}"
										itemValue="#{estruc.id}" />
								</p:selectOneMenu>
								<p:message for="listBloque" />
							</div>

							<div class="col-md-4 col-xs-12">
								<p:outputLabel styleClass="requerido" value="Evento:" />
								<p:selectOneMenu id="listEvento" styleClass="col-xs-12"
									valueChangeListener="#{eventoCapacitacionBean.onChangeCatEstructura}">
									<p:ajax update="@form" />
									<f:selectItem
										itemLabel="#{sistema.obtenerTexto('gw.textos.menu.seleccionar')}"
										itemValue="#{0}" />
									<f:selectItems value="#{eventoCapacitacionBean.catEstructuras}"
										var="estruc" itemLabel="#{estruc.nombre}"
										itemValue="#{estruc.id}" />
								</p:selectOneMenu>
								<p:message for="listEvento" />
							</div>
						</div>
					</div>


				</f:validateBean>
				<!-- Row 4 -->
				<div class="row">
					<!-- Leyenda campos requeridos-->
					<div class="col-md-4">
						<p:outputLabel
							value="#{sistema.obtenerTexto('gw.gestionescolar.label.camposRequeridos')}"
							styleClass="requerido" />
					</div>
					<!-- Busqueda de Eventos de capacitacion -->
					<div class="col-md-8 text-right">
						<p:commandButton value="Limpiar campos" process="@this"
							update="frmBusqueda frmtabla"
							action="#{eventoCapacitacionBean.limpiarCampos}" ajax="true"
							styleClass="btn btn-default" />
						<p:commandButton styleClass="btn btn-primary" value="Buscar"
							action="#{eventoCapacitacionBean.buscarEventosCapacitacion}"
							ajax="true" update="frmtabla frmBusqueda" />
					</div>
				</div>

			</p:panel>

		</h:form>
		<h:form id="frmtabla">

			<p:importEnum
				type="mx.gob.sedesol.gestorweb.commons.utils.EstadoEventoCapEnum"
				var="ESTADO_EVENTO" allSuffix="ALL_ENUM_VALUES" />

			<p:panel header="Resumen de Inscripción">


				<div class="row">
					<div class="col-md-12">
						<p:dataTable id="dtResultBusqEventCap"
							emptyMessage="#{sistema.obtenerTexto('gw.textos.tablas.sinRegistros')}"
							value="#{eventoCapacitacionBean.eventosCapacitacion}"
							var="evento" paginator="true" rows="10"
							paginatorPosition="bottom"
							paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
							currentPageReportTemplate="({currentPage} de {totalPages})"
							rowsPerPageTemplate="5,10,15" tableStyleClass="table">
							<!-- Programa Educativo -->
							<p:column styleClass="text-center">
								<f:facet name="header">
									<h:outputText value="Programa Educativo" />
								</f:facet>
								<h:outputText value="#{evento.idEvento}" />
							</p:column>
							<!-- Asignatura -->
							<p:column>
								<f:facet name="header">
									<h:outputText value="Asignatura" />
								</f:facet>
								<h:outputText value="#{evento.nombreEc}" />
							</p:column>
							<!-- Sigla -->
							<p:column>
								<f:facet name="header">
									<h:outputText value="Sigla" />
								</f:facet>
								<h:outputText
									value="#{eventoCapacitacionBean.obtenerRuta(evento)}" />
							</p:column>

							<!-- Semestre -->
							<p:column>
								<f:facet name="header">
									<h:outputText value="Semestre" />
								</f:facet>
								<h:outputText value="#{evento.catModalidadPlanPrograma.nombre}" />
							</p:column>

							<!-- Bloque -->
							<p:column>
								<f:facet name="header">
									<h:outputText value="Bloque" />
								</f:facet>
								<h:outputText value="#{evento.fechaInicial}">
									<f:convertDateTime type="date"
										pattern="#{sistema.obtenerTexto('gw.textos.menu.formatoFecha')}" />
								</h:outputText>
							</p:column>
							<!-- Estudiante con inscripcion -->
							<p:column>
								<f:facet name="header">
									<h:outputText value="Estudiante con inscripción" />
								</f:facet>
								<h:outputText value="#{evento.fechaFinal}">
									<f:convertDateTime type="date"
										pattern="#{sistema.obtenerTexto('gw.textos.menu.formatoFecha')}" />
								</h:outputText>
							</p:column>

							<!-- Grupos generales -->
							<p:column>
								<f:facet name="header">
									<h:outputText value="Grupos generales" />
								</f:facet>
								<h:outputText value="#{evento.fechaFinal}">
									<f:convertDateTime type="date"
										pattern="#{sistema.obtenerTexto('gw.textos.menu.formatoFecha')}" />
								</h:outputText>
							</p:column>

							<!-- Cupo general -->
							<p:column>
								<f:facet name="header">
									<h:outputText value="Cupo general" />
								</f:facet>
								<h:outputText value="#{evento.fechaFinal}">
									<f:convertDateTime type="date"
										pattern="#{sistema.obtenerTexto('gw.textos.menu.formatoFecha')}" />
								</h:outputText>
							</p:column>

							<!-- Grupo resto -->
							<p:column>
								<f:facet name="header">
									<h:outputText value="Grupo resto" />
								</f:facet>
								<h:outputText value="#{evento.fechaFinal}">
									<f:convertDateTime type="date"
										pattern="#{sistema.obtenerTexto('gw.textos.menu.formatoFecha')}" />
								</h:outputText>
							</p:column>

							<!-- Cupo resto -->
							<p:column>
								<f:facet name="header">
									<h:outputText value="Cupo resto" />
								</f:facet>
								<h:outputText value="#{evento.fechaFinal}">
									<f:convertDateTime type="date"
										pattern="#{sistema.obtenerTexto('gw.textos.menu.formatoFecha')}" />
								</h:outputText>
							</p:column>



						</p:dataTable>
					</div>
				</div>
			</p:panel>

			<div class="row">

				<!--Dispersion -->
				<div class="col-md-8 text-right">

					<p:commandButton value="Crear grupos"
								styleClass="btn btn-primary pull-right" update="fldDispersar"
								action="#{dispersionBean.generarGrupos()}" ajax="false"
								immediate="true" process="@this" />
								
					<p:commandButton styleClass="btn btn-primary" value="Dispersar"
						action="#{eventoCapacitacionBean.buscarEventosCapacitacion}"
						ajax="true" update="frmtabla frmBusqueda" />
				</div>
			</div>
		</h:form>
	</ui:define>
</ui:composition>