<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html>
<ui:composition template="/templates/layout.xhtml"
				xmlns="http://www.w3.org/1999/xhtml"
				xmlns:h="http://java.sun.com/jsf/html"
				xmlns:ui="http://java.sun.com/jsf/facelets"
				xmlns:f="http://java.sun.com/jsf/core"
				xmlns:p="http://primefaces.org/ui"
				xmlns:c="http://java.sun.com/jsp/jstl/core"
				xmlns:sec="http://www.springframework.org/security/tags">


	<ui:define name="breadcrumb">
		<li>#{sistema.obtenerTexto('gw.gestionescolar.label.gestionEscolar')}</li>
		<li class="active">Eventos academicos</li>
	</ui:define>

	<ui:define name="content">

		<h1>Dispersion</h1>
		<hr />

		<h:form id="frmBusqueda">
			<p:ajaxStatus onstart="PF('dialogLayout').show()"
						  onsuccess="PF('dialogLayout').hide()" />

			<p:panel id="fldDispersar" header="Generar dispersión"
				showCollapseLink="false" collapsible="false" visible="true">
				<f:validateBean disabled="true">
					<div class="row">
						<div class="col-md-4 col-xs-12">
							<p:outputLabel styleClass="requerido" value="Plan:" />
							<p:selectCheckboxMenu id="planesMenu"
								value="#{dispersionBean.selectedPlanes}" filter="true"
								filterMatchMode="startsWith"
								label="#{sistema.obtenerTexto('gw.textos.menu.seleccionar')}"
								styleClass="col-xs-12">
								<p:ajax process="@this" update="@this" event="toggleSelect"
									listener="#{dispersionBean.planesSelectChange}" />
								<p:ajax process="@this" update="@this" event="change"
									listener="#{dispersionBean.planesSelectChange()}" />
								<f:selectItems value="#{dispersionBean.listaPlanes}" var="plan"
									itemLabel="#{plan.nombre}" itemValue="#{plan.nombre}" />
							</p:selectCheckboxMenu>
						</div>
						<p:outputPanel id="pnlEstructuras2">
								<p:outputPanel
										rendered="#{not empty eventoCapacitacionBean.catEstructuras}">
									<div class="col-md-4 col-xs-12">
										<p:outputLabel styleClass="requerido" value="Estructura:"/>
										<p:selectOneMenu id="nvoCatEstruc_2" styleClass="col-xs-12"
														 valueChangeListener="#{eventoCapacitacionBean.onChangeCatEstructura}">
											<p:ajax update="@form"/>
											<f:selectItem
													itemLabel="#{sistema.obtenerTexto('gw.textos.menu.seleccionar')}"
													itemValue="#{0}"/>
											<f:selectItems
													value="#{eventoCapacitacionBean.catEstructuras}"
													var="estruc" itemLabel="#{estruc.nombre}"
													itemValue="#{estruc.id}"/>
										</p:selectOneMenu>
										<p:message for="nvoCatEstruc_2"/>
									</div>
								</p:outputPanel>
							</p:outputPanel>

							<p:outputPanel id="pnlSubestructuras_3">
								<p:outputPanel
										rendered="#{not empty eventoCapacitacionBean.catSubEstructurasNivel1}">
									<div class="col-md-4 col-xs-12">
										<p:outputLabel styleClass="requerido" value="Subestructura 1:"/>
										<p:selectOneMenu id="nvoCatSubEstruc_2" styleClass="col-xs-12"
														 valueChangeListener="#{eventoCapacitacionBean.onChangeCatSubestructura1}">
											<p:ajax update="@form"/>
											<f:selectItem
													itemLabel="#{sistema.obtenerTexto('gw.textos.menu.seleccionar')}"
													itemValue="#{0}"/>
											<f:selectItems
													value="#{eventoCapacitacionBean.catSubEstructurasNivel1}"
													var="subEstruc1" itemLabel="#{subEstruc1.nombre}"
													itemValue="#{subEstruc1.id}"/>
										</p:selectOneMenu>
										<p:message for="nvoCatSubEstruc_2"/>
									</div>
								</p:outputPanel>
							</p:outputPanel>
						<div class="col-md-12">
							<!-- Leyenda campos requeridos-->
							<div class="col-md-4">
								<p:outputLabel
										value="#{sistema.obtenerTexto('gw.gestionescolar.label.camposRequeridos')}"
										styleClass="requerido" />
							</div>
							<p:commandButton value="Dispersar"
								styleClass="btn btn-primary pull-right" update="fldDispersar"
								action="#{dispersionBean.dispersar()}" ajax="false"
								immediate="true" process="@this" />
							<p:commandButton value="Crear grupos"
								styleClass="btn btn-primary pull-right" update="fldDispersar"
								action="#{dispersionBean.generarGrupos()}" ajax="false"
								immediate="true" process="@this" />
						</div>
					</div>
				</f:validateBean>
			</p:panel>

			<div class="row">
				<div class="col-md-12">
					<sec:authorize access="hasPermission(null, 'EC_AGR' ) ">
						<p:commandButton
							value="#{sistema.obtenerTexto('gw.ge.btn.crear')}"
							styleClass="btn btn-primary pull-right"
							update="frmBusquedaPrograma"
							action="#{capturaEventoCapacitacion.nuevoEventoCapacitacion()}"
							ajax="false" immediate="true" process="@this" />
						<p:outputLabel value="Nuevo evento académico:"
							styleClass="pull-right agregaHeight" />
					</sec:authorize>
				</div>
			</div>

			<p:panel id="fldBusqueda"
					 header="Búsqueda de eventos académicos"
					 showCollapseLink="false" collapsible="false">
				<f:validateBean disabled="true">
					<!-- Row 1 -->
					<div class="form-group">
						<div class="row">
							<div class="col-md-4 col-xs-12">
								<p:outputLabel styleClass="requerido" value="Plan:"/>
								<p:selectOneMenu id="nvoCatPlan" styleClass="col-xs-12"
												 value="#{eventoCapacitacionBean.idPlan}"
												 valueChangeListener="#{eventoCapacitacionBean.onChangeCatPlan}">
									<p:ajax update="@form"/>
									<f:selectItem
											itemLabel="#{sistema.obtenerTexto('gw.textos.menu.seleccionar')}"
											itemValue="#{0}"/>
									<f:selectItems value="#{eventoCapacitacionBean.nodos}"
												   var="plan" itemLabel="#{plan.nombre}" itemValue="#{plan.idNodo}"/>
								</p:selectOneMenu>
								<p:message for="nvoCatPlan"/>
							</div>

							<p:outputPanel id="pnlEstructuras">
								<p:outputPanel
										rendered="#{not empty eventoCapacitacionBean.catEstructuras}">
									<div class="col-md-4 col-xs-12">
										<p:outputLabel styleClass="requerido" value="Estructura:"/>
										<p:selectOneMenu id="nvoCatEstruc" styleClass="col-xs-12"
														 valueChangeListener="#{eventoCapacitacionBean.onChangeCatEstructura}">
											<p:ajax update="@form"/>
											<f:selectItem
													itemLabel="#{sistema.obtenerTexto('gw.textos.menu.seleccionar')}"
													itemValue="#{0}"/>
											<f:selectItems
													value="#{eventoCapacitacionBean.catEstructuras}"
													var="estruc" itemLabel="#{estruc.nombre}"
													itemValue="#{estruc.id}"/>
										</p:selectOneMenu>
										<p:message for="nvoCatEstruc"/>
									</div>
								</p:outputPanel>
							</p:outputPanel>

							<p:outputPanel id="pnlSubestructuras1">
								<p:outputPanel
										rendered="#{not empty eventoCapacitacionBean.catSubEstructurasNivel1}">
									<div class="col-md-4 col-xs-12">
										<p:outputLabel styleClass="requerido" value="Subestructura 1:"/>
										<p:selectOneMenu id="nvoCatSubEstruc1" styleClass="col-xs-12"
														 valueChangeListener="#{eventoCapacitacionBean.onChangeCatSubestructura1}">
											<p:ajax update="@form"/>
											<f:selectItem
													itemLabel="#{sistema.obtenerTexto('gw.textos.menu.seleccionar')}"
													itemValue="#{0}"/>
											<f:selectItems
													value="#{eventoCapacitacionBean.catSubEstructurasNivel1}"
													var="subEstruc1" itemLabel="#{subEstruc1.nombre}"
													itemValue="#{subEstruc1.id}"/>
										</p:selectOneMenu>
										<p:message for="nvoCatSubEstruc1"/>
									</div>
								</p:outputPanel>
							</p:outputPanel>


							<p:outputPanel id="pnlSubestructuras2">
								<p:outputPanel
										rendered="#{not empty eventoCapacitacionBean.catSubEstructurasNivel2}">
									<div class="col-md-4 col-xs-12" style="margin-top: 15px;">
										<p:outputLabel styleClass="requerido" value="Subestructura 2:"/>
										<p:selectOneMenu id="nvoCatSubEstruc2" styleClass="col-xs-12"
														 valueChangeListener="#{eventoCapacitacionBean.onChangeCatSubestructura2}">
											<p:ajax update="@form"/>
											<f:selectItem
													itemLabel="#{sistema.obtenerTexto('gw.textos.menu.seleccionar')}"
													itemValue="#{0}"/>
											<f:selectItems
													value="#{eventoCapacitacionBean.catSubEstructurasNivel2}"
													var="subEstruc2" itemLabel="#{subEstruc2.nombre}"
													itemValue="#{subEstruc2.id}"/>
										</p:selectOneMenu>
										<p:message for="nvoCatSubEstruc2"/>
									</div>
								</p:outputPanel>
							</p:outputPanel>


							<p:outputPanel id="pnlSubestructuras3">
								<p:outputPanel
										rendered="#{not empty eventoCapacitacionBean.catSubEstructurasNivel3}">
									<div class="col-md-4 col-xs-12" style="margin-top: 15px;">
										<p:outputLabel styleClass="requerido" value="Subestructura 3:"/>
										<p:selectOneMenu id="nvoCatSubEstruc3" styleClass="col-xs-12"
														 valueChangeListener="#{eventoCapacitacionBean.onChangeCatSubestructura3}">
											<p:ajax update="@form"/>
											<f:selectItem
													itemLabel="#{sistema.obtenerTexto('gw.textos.menu.seleccionar')}"
													itemValue="#{0}"/>
											<f:selectItems
													value="#{eventoCapacitacionBean.catSubEstructurasNivel3}"
													var="subEstruc3" itemLabel="#{subEstruc3.nombre}"
													itemValue="#{subEstruc3.id}"/>
										</p:selectOneMenu>
										<p:message for="nvoCatSubEstruc3"/>
									</div>
								</p:outputPanel>
							</p:outputPanel>

						</div>
					</div>

				</f:validateBean>
				<!-- Row 4 -->
				<div class="row">
					<!-- Leyenda campos requeridos-->
					<div class="col-md-4">
						<p:outputLabel
								value="#{sistema.obtenerTexto('gw.gestionescolar.label.camposRequeridos')}"
								styleClass="requerido" />
					</div>
					<!-- Busqueda de Eventos de capacitacion -->
					<div class="col-md-8 text-right">
						<p:commandButton value="Limpiar campos" process="@this"
										 update="frmBusqueda frmtabla"
										 action="#{eventoCapacitacionBean.limpiarCampos}" ajax="true"
										 styleClass="btn btn-default" />
						<p:commandButton styleClass="btn btn-primary" value="Buscar"
										 action="#{eventoCapacitacionBean.buscarEventosCapacitacion}"
										 ajax="true" update="frmtabla frmBusqueda" />
					</div>
				</div>

			</p:panel>

		</h:form>
		
	</ui:define>
</ui:composition>